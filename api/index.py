from fastapi import FastAPI, HTTPException
from fastapi.middleware.cors import CORSMiddleware
from pydantic import BaseModel
from typing import List, Optional
import json
import random
from datetime import datetime
import sqlite3
import os
import requests  # –í–∞–∂–Ω—ã–π –∏–º–ø–æ—Ä—Ç

app = FastAPI(title="Tarot Web App API")

# –†–∞–∑—Ä–µ—à–∞–µ–º CORS –¥–ª—è –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
class DrawRequest(BaseModel):
    question: str
    count: int = 5
    user_id: Optional[int] = None

class SaveRequest(BaseModel):
    user_id: int
    question: str
    cards: List[dict]
    interpretation: str = ""

# ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ë–ê–ó–´ –î–ê–ù–ù–´–• ==========
def init_db():
    db_path = "/tmp/tarot_history.db" if os.environ.get("VERCEL") else "tarot_history.db"
    
    conn = sqlite3.connect(db_path)
    cursor = conn.cursor()
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS readings (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            user_id INTEGER,
            question TEXT,
            cards TEXT,
            interpretation TEXT,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )
    ''')
    conn.commit()
    conn.close()
    return db_path

DB_PATH = init_db()

# ========== –ó–ê–ì–†–£–ó–ö–ê –ö–ê–†–¢ –¢–ê–†–û ==========
def load_tarot_cards():
    """–ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –∫–∞—Ä—Ç –¢–∞—Ä–æ –∏–∑ file_ids.json"""
    try:
        print("=" * 50)
        print("üîÑ –ù–ê–ß–ê–õ–û –ó–ê–ì–†–£–ó–ö–ò –ö–ê–†–¢ –¢–ê–†–û")
        print("=" * 50)
        
        # –¢–û–ß–ù–´–ô –ü–£–¢–¨ –∫ —Ñ–∞–π–ª—É
        file_path = "api/file_ids.json"
        print(f"üîç –ò—â—É —Ñ–∞–π–ª –ø–æ –ø—É—Ç–∏: {file_path}")
        print(f"üìÅ –¢–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: {os.getcwd()}")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
        if os.path.exists(file_path):
            print(f"‚úÖ –§–∞–π–ª –Ω–∞–π–¥–µ–Ω: {file_path}")
            print(f"üìä –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: {os.path.getsize(file_path)} –±–∞–π—Ç")
        else:
            print(f"‚ùå –§–∞–π–ª –ù–ï –Ω–∞–π–¥–µ–Ω: {file_path}")
            print("üìÅ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:")
            try:
                for item in os.listdir('.'):
                    print(f"  - {item}")
            except Exception as e:
                print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏: {e}")
            return []
        
        # –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª
        try:
            with open(file_path, 'r', encoding='utf-8') as f:
                loaded_data = json.load(f)
                print(f"‚úÖ JSON —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω")
                print(f"üìà –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –≤ JSON: {len(loaded_data)}")
                
                # –í—ã–≤–æ–¥–∏–º –ø–µ—Ä–≤—ã–µ 3 –∫–∞—Ä—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
                print("üé¥ –ü—Ä–∏–º–µ—Ä—ã –∫–∞—Ä—Ç:")
                for i, (name, file_id) in enumerate(list(loaded_data.items())[:3]):
                    print(f"  {i+1}. {name} -> {file_id[:30]}...")
        except json.JSONDecodeError as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON: {e}")
            return []
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞: {e}")
            return []
        
        # –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∫–∞—Ä—Ç
        print("üìö –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∫–∞—Ä—Ç...")
        card_meanings = get_card_meanings()
        print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–π –∫–∞—Ä—Ç: {len(card_meanings)}")
        
        # –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã
        tarot_cards = []
        processed_count = 0
        
        for i, (name, file_id) in enumerate(loaded_data.items()):
            # –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∫–∞—Ä—Ç—ã
            meaning_data = card_meanings.get(name, {})
            
            if not meaning_data:
                print(f"‚ö†Ô∏è –î–ª—è –∫–∞—Ä—Ç—ã '{name}' –Ω–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–π –≤ card_meanings")
            
            upright_meaning = meaning_data.get("upright", f"–ü—Ä—è–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ {name}")
            reversed_meaning = meaning_data.get("reversed", f"–ü–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ {name}")
            
            tarot_cards.append({
                "id": i,
                "name": name,
                "file_id": file_id,
                "meaning_upright": upright_meaning,
                "meaning_reversed": reversed_meaning
            })
            
            processed_count += 1
            if processed_count <= 3:  # –õ–æ–≥–∏—Ä—É–µ–º –ø–µ—Ä–≤—ã–µ 3 –∫–∞—Ä—Ç—ã
                print(f"  üÉè –ö–∞—Ä—Ç–∞ {processed_count}: {name}")
                print(f"    file_id: {file_id[:20]}...")
                print(f"    upright: {upright_meaning[:30]}...")
        
        print("=" * 50)
        print(f"üéâ –ó–ê–ì–†–†–£–ó–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê")
        print(f"üì¶ –í—Å–µ–≥–æ –∫–∞—Ä—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: {len(tarot_cards)}")
        print("=" * 50)
        
        return tarot_cards
        
    except Exception as e:
        print(f"üí• –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: {e}")
        import traceback
        traceback.print_exc()
        return []
def get_card_meanings(card_name, orientation):
    """–ü–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã –ø–æ –∏–º–µ–Ω–∏ –∏–∑ –ø–æ–ª–Ω–æ–≥–æ —Å–ª–æ–≤–∞—Ä—è"""
    
    # –ü–û–õ–ù–´–ô –°–õ–û–í–ê–†–¨ –ó–ù–ê–ß–ï–ù–ò–ô (78 –∫–∞—Ä—Ç)
    TAROT_MEANINGS = {
        "–®—É—Ç": {
            "upright": "–ù–∞—á–∞–ª–æ –ø—É—Ç–∏, —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ—Å—Ç—å, —Å–≤–æ–±–æ–¥–∞",
            "reversed": "–ë–µ–∑—Ä–∞—Å—Å—É–¥—Å—Ç–≤–æ, —Ä–∏—Å–∫, –Ω–µ–∑—Ä–µ–ª–æ—Å—Ç—å"
        },
        "–ú–∞–≥": {
            "upright": "–°–∏–ª–∞ –≤–æ–ª–∏, –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ, –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è",
            "reversed": "–û–±–º–∞–Ω, –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏, —Å–ª–∞–±–æ—Å—Ç—å"
        },
        "–í–µ—Ä—Ö–æ–≤–Ω–∞—è –ñ—Ä–∏—Ü–∞": {
            "upright": "–ò–Ω—Ç—É–∏—Ü–∏—è, —Ç–∞–π–Ω—ã, –ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–µ",
            "reversed": "–°–∫—Ä—ã—Ç—ã–µ –º–æ—Ç–∏–≤—ã, –ø–æ–¥–∞–≤–ª–µ–Ω–Ω–∞—è –∏–Ω—Ç—É–∏—Ü–∏—è"
        },
        "–ò–º–ø–µ—Ä–∞—Ç—Ä–∏—Ü–∞": {
            "upright": "–ò–∑–æ–±–∏–ª–∏–µ, –ø—Ä–∏—Ä–æ–¥–∞, –ø–ª–æ–¥–æ—Ä–æ–¥–∏–µ, –∫—Ä–∞—Å–æ—Ç–∞",
            "reversed": "–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, —Ä–∞—Å—Ç–æ—á–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –±–µ–∑–¥–µ–π—Å—Ç–≤–∏–µ"
        },
        "–ò–º–ø–µ—Ä–∞—Ç–æ—Ä": {
            "upright": "–í–ª–∞—Å—Ç—å, –∫–æ–Ω—Ç—Ä–æ–ª—å, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å",
            "reversed": "–¢–∏—Ä–∞–Ω–∏—è, –∂–µ—Å—Ç–∫–æ—Å—Ç—å, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã"
        },
        "–ò–µ—Ä–æ—Ñ–∞–Ω—Ç": {
            "upright": "–¢—Ä–∞–¥–∏—Ü–∏–∏, –¥—É—Ö–æ–≤–Ω–æ—Å—Ç—å, –≤–µ—Ä–∞, –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ",
            "reversed": "–î–æ–≥–º–∞—Ç–∏–∑–º, –ª–∏—Ü–µ–º–µ—Ä–∏–µ, –ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ"
        },
        "–í–ª—é–±–ª–µ–Ω–Ω—ã–µ": {
            "upright": "–õ—é–±–æ–≤—å, –≥–∞—Ä–º–æ–Ω–∏—è, –ø–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ, –≤—ã–±–æ—Ä",
            "reversed": "–†–∞–∑–ª–∞–¥, –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã, –Ω–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä"
        },
        "–ö–æ–ª–µ—Å–Ω–∏—Ü–∞": {
            "upright": "–ü–æ–±–µ–¥–∞, –∫–æ–Ω—Ç—Ä–æ–ª—å, –¥–≤–∏–∂–µ–Ω–∏–µ –≤–ø–µ—Ä–µ–¥, –≤–æ–ª—è",
            "reversed": "–ü–æ—Ç–µ—Ä—è –∫–æ–Ω—Ç—Ä–æ–ª—è, –∞–≤–∞—Ä–∏—è, –∑–∞—Å—Ç–æ–π"
        },
        "–°–∏–ª–∞": {
            "upright": "–°–º–µ–ª–æ—Å—Ç—å, —Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏–µ, –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–∏–ª–∞, —Ç–µ—Ä–ø–µ–Ω–∏–µ",
            "reversed": "–°–ª–∞–±–æ—Å—Ç—å, –Ω–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Å–∏–ª–æ–π"
        },
        "–û—Ç—à–µ–ª—å–Ω–∏–∫": {
            "upright": "–†–∞–∑–º—ã—à–ª–µ–Ω–∏—è, –ø–æ–∏—Å–∫ –∏—Å—Ç–∏–Ω—ã, –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–æ, –º—É–¥—Ä–æ—Å—Ç—å",
            "reversed": "–ò–∑–æ–ª—è—Ü–∏—è, –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–æ, –æ—Ç–∫–∞–∑ –æ—Ç –ø–æ–º–æ—â–∏"
        },
        "–ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã": {
            "upright": "–°—É–¥—å–±–∞, —Ü–∏–∫–ª—ã, —É–¥–∞—á–∞, –ø–µ—Ä–µ–º–µ–Ω—ã",
            "reversed": "–ù–µ—É–¥–∞—á–∏, —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–∞–º, –ø–ª–æ—Ö–æ–π –ø–µ—Ä–∏–æ–¥"
        },
        "–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å": {
            "upright": "–ü—Ä–∞–≤–æ—Å—É–¥–∏–µ, –∫–∞—Ä–º–∞, —Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ, –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å",
            "reversed": "–ù–µ—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å, –ø—Ä–µ–¥–≤–∑—è—Ç–æ—Å—Ç—å, –±–µ–∑–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å"
        },
        "–ü–æ–≤–µ—à–µ–Ω–Ω—ã–π": {
            "upright": "–ñ–µ—Ä—Ç–≤–∞, –ø–µ—Ä–µ–æ—Ü–µ–Ω–∫–∞, —Å–¥–∞—á–∞, –Ω–æ–≤–∞—è –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∞",
            "reversed": "–ë–µ–∑–¥–µ–π—Å—Ç–≤–∏–µ, –ø—Ä–æ–º–µ–¥–ª–µ–Ω–∏–µ, —ç–≥–æ–∏–∑–º"
        },
        "–°–º–µ—Ä—Ç—å": {
            "upright": "–ö–æ–Ω–µ—Ü, —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è, –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ, –ø–µ—Ä–µ—Ö–æ–¥",
            "reversed": "–ó–∞—Å—Ç–æ–π, —Å—Ç—Ä–∞—Ö –ø–µ—Ä–µ–º–µ–Ω, –º–µ–¥–ª–µ–Ω–Ω–∞—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è"
        },
        "–£–º–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å": {
            "upright": "–ë–∞–ª–∞–Ω—Å, —Ç–µ—Ä–ø–µ–Ω–∏–µ, –≥–∞—Ä–º–æ–Ω–∏—è, –∏—Å—Ü–µ–ª–µ–Ω–∏–µ",
            "reversed": "–î–∏—Å–±–∞–ª–∞–Ω—Å, –Ω–µ—Ç–µ—Ä–ø–µ–Ω–∏–µ, —ç–∫—Å—Ç—Ä–µ–º–∏–∑–º"
        },
        "–î—å—è–≤–æ–ª": {
            "upright": "–°–æ–±–ª–∞–∑–Ω, –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–º, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è",
            "reversed": "–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ, –ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ –∏—Å–∫—É—à–µ–Ω–∏–π, —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ –ø—Ä–∞–≤–¥—ã"
        },
        "–ë–∞—à–Ω—è": {
            "upright": "–í–Ω–µ–∑–∞–ø–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, —Ä–∞–∑—Ä—É—à–µ–Ω–∏–µ, –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ, –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ",
            "reversed": "–°—Ç—Ä–∞—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π, —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ, –æ—Ç—Å—Ä–æ—á–∫–∞ –Ω–µ–∏–∑–±–µ–∂–Ω–æ–≥–æ"
        },
        "–ó–≤–µ–∑–¥–∞": {
            "upright": "–ù–∞–¥–µ–∂–¥–∞, –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ, –¥—É—Ö–æ–≤–Ω–æ—Å—Ç—å, –∏—Å—Ü–µ–ª–µ–Ω–∏–µ",
            "reversed": "–û—Ç—á–∞—è–Ω–∏–µ, –ø–æ—Ç–µ—Ä—è –≤–µ—Ä—ã, –ø–µ—Å—Å–∏–º–∏–∑–º"
        },
        "–õ—É–Ω–∞": {
            "upright": "–ò–ª–ª—é–∑–∏–∏, –ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–µ, –∏–Ω—Ç—É–∏—Ü–∏—è, —Ç–∞–π–Ω—ã",
            "reversed": "–°—Ç—Ä–∞—Ö–∏, –æ–±–º–∞–Ω, –ø—É—Ç–∞–Ω–∏—Ü–∞, –ø–æ–¥–∞–≤–ª–µ–Ω–Ω—ã–µ —ç–º–æ—Ü–∏–∏"
        },
        "–°–æ–ª–Ω—Ü–µ": {
            "upright": "–†–∞–¥–æ—Å—Ç—å, —É—Å–ø–µ—Ö, –∂–∏–∑–Ω–µ–Ω–Ω–∞—è —Å–∏–ª–∞, –æ–ø—Ç–∏–º–∏–∑–º",
            "reversed": "–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏, –∑–∞–¥–µ—Ä–∂–∫–∏, –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏"
        },
        "–°—É–¥": {
            "upright": "–í–æ–∑—Ä–æ–∂–¥–µ–Ω–∏–µ, –ø—Ä–∏–∑—ã–≤, –ø—Ä–æ—â–µ–Ω–∏–µ, —Å—É–¥—å–±–∞",
            "reversed": "–°–æ–∂–∞–ª–µ–Ω–∏—è, –≤–∏–Ω–∞, —Å—Ç—Ä–∞—Ö –ø–µ—Ä–µ–º–µ–Ω, –æ—Ç–∫–∞–∑ –æ—Ç –ø—Ä–∏–∑—ã–≤–∞"
        },
        "–ú–∏—Ä": {
            "upright": "–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ, –≥–∞—Ä–º–æ–Ω–∏—è, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ, –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ",
            "reversed": "–ù–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ—Å—Ç—å, –∑–∞–¥–µ—Ä–∂–∫–∏, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞–∫—Ä—ã—Ç–∏—è"
        },
        "–¢—É–∑ –ñ–µ–∑–ª–æ–≤": {
            "upright": "–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ, –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ, –Ω–æ–≤—ã–µ –Ω–∞—á–∏–Ω–∞–Ω–∏—è, —ç–Ω–µ—Ä–≥–∏—è",
            "reversed": "–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–¥–µ–π, –∑–∞–¥–µ—Ä–∂–∫–∏, –ø–æ–¥–∞–≤–ª–µ–Ω–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è"
        },
        "–î–≤–æ–π–∫–∞ –ñ–µ–∑–ª–æ–≤": {
            "upright": "–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –±—É–¥—É—â–µ–µ, —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ, –ø–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ",
            "reversed": "–°—Ç—Ä–∞—Ö –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ, –ø–ª–æ—Ö–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ä–∞–∑–æ–±—â–µ–Ω–Ω–æ—Å—Ç—å"
        },
        "–¢—Ä–æ–π–∫–∞ –ñ–µ–∑–ª–æ–≤": {
            "upright": "–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ, —Ä–æ—Å—Ç, —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ, –ø—Ä–æ–≥—Ä–µ—Å—Å",
            "reversed": "–ó–∞–¥–µ—Ä–∂–∫–∏, –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è, —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω–∏–µ"
        },
        "–ß–µ—Ç–≤–µ—Ä–∫–∞ –ñ–µ–∑–ª–æ–≤": {
            "upright": "–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, –ø—Ä–∞–∑–¥–Ω–∏–∫, –≥–∞—Ä–º–æ–Ω–∏—è, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è",
            "reversed": "–ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã, –æ—Ç—Å—Ä–æ—á–∫–∞ —Ä–∞–¥–æ—Å—Ç–∏"
        },
        "–ü—è—Ç–µ—Ä–∫–∞ –ñ–µ–∑–ª–æ–≤": {
            "upright": "–ö–æ–Ω—Ñ–ª–∏–∫—Ç, —Å–æ–ø–µ—Ä–Ω–∏—á–µ—Å—Ç–≤–æ, –¥–µ–±–∞—Ç—ã, –≤—ã–∑–æ–≤",
            "reversed": "–ò–∑–±–µ–≥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞, –º–∏—Ä, –ø—Ä–∏–º–∏—Ä–µ–Ω–∏–µ"
        },
        "–®–µ—Å—Ç–µ—Ä–∫–∞ –ñ–µ–∑–ª–æ–≤": {
            "upright": "–ü–æ–±–µ–¥–∞, —É—Å–ø–µ—Ö, –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ, —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å",
            "reversed": "–ù–µ—É–¥–∞—á–∞, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–∏–∑–Ω–∞–Ω–∏—è, –∑–∞–Ω–∏–∂–µ–Ω–Ω–∞—è —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∞"
        },
        "–°–µ–º–µ—Ä–∫–∞ –ñ–µ–∑–ª–æ–≤": {
            "upright": "–ó–∞—â–∏—Ç–∞, –Ω–∞—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å, –æ—Ç—Å—Ç–∞–∏–≤–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π",
            "reversed": "–°–¥–∞—á–∞, –ø–µ—Ä–µ—É—Ç–æ–º–ª–µ–Ω–∏–µ, –æ—Ç—Å—Ç—É–ø–ª–µ–Ω–∏–µ"
        },
        "–í–æ—Å—å–º–µ—Ä–∫–∞ –ñ–µ–∑–ª–æ–≤": {
            "upright": "–ë—ã—Å—Ç—Ä–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ, –¥–µ–π—Å—Ç–≤–∏–µ, –Ω–æ–≤–æ—Å—Ç–∏, –ø—Ä–æ–≥—Ä–µ—Å—Å",
            "reversed": "–ó–∞–¥–µ—Ä–∂–∫–∏, —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω–∏–µ, –ø–æ—Å–ø–µ—à–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è"
        },
        "–î–µ–≤—è—Ç–∫–∞ –ñ–µ–∑–ª–æ–≤": {
            "upright": "–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å, –∑–∞—â–∏—Ç–∞, –ø–æ—Å–ª–µ–¥–Ω–µ–µ —É—Å–∏–ª–∏–µ, –±–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å",
            "reversed": "–û–±–æ—Ä–æ–Ω–∞, –ø–∞—Ä–∞–Ω–æ–π—è, –∏—Å—Ç–æ—â–µ–Ω–∏–µ"
        },
        "–î–µ—Å—è—Ç–∫–∞ –ñ–µ–∑–ª–æ–≤": {
            "upright": "–ë—Ä–µ–º—è, –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å, —Ç—è–∂–µ–ª–∞—è —Ä–∞–±–æ—Ç–∞, –¥–∞–≤–ª–µ–Ω–∏–µ",
            "reversed": "–°–Ω—è—Ç–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏, –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ"
        },
        "–ü–∞–∂ –ñ–µ–∑–ª–æ–≤": {
            "upright": "–≠–Ω—Ç—É–∑–∏–∞–∑–º, –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ, –Ω–æ–≤–æ—Å—Ç–∏, —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ",
            "reversed": "–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –ø—Ä–æ–º–µ–¥–ª–µ–Ω–∏–µ, –ø–ª–æ—Ö–∏–µ –Ω–æ–≤–æ—Å—Ç–∏"
        },
        "–†—ã—Ü–∞—Ä—å –ñ–µ–∑–ª–æ–≤": {
            "upright": "–î–µ–π—Å—Ç–≤–∏–µ, –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ, —ç–Ω–µ—Ä–≥–∏—è, –∏–º–ø—É–ª—å—Å–∏–≤–Ω–æ—Å—Ç—å",
            "reversed": "–ù–µ—Ç–µ—Ä–ø–µ–Ω–∏–µ, –±–µ–∑—Ä–∞—Å—Å—É–¥—Å—Ç–≤–æ, –∑–∞–¥–µ—Ä–∂–∫–∏"
        },
        "–ö–æ—Ä–æ–ª–µ–≤–∞ –ñ–µ–∑–ª–æ–≤": {
            "upright": "–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, —Ö–∞—Ä–∏–∑–º–∞, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, –æ–ø—Ç–∏–º–∏–∑–º",
            "reversed": "–†–µ–≤–Ω–æ—Å—Ç—å, –Ω–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å"
        },
        "–ö–æ—Ä–æ–ª—å –ñ–µ–∑–ª–æ–≤": {
            "upright": "–õ–∏–¥–µ—Ä—Å—Ç–≤–æ, –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å—Å—Ç–≤–æ, –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ, –≤–∏–¥–µ–Ω–∏–µ",
            "reversed": "–¢–∏—Ä–∞–Ω–∏—è, –¥–æ–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –∏–º–ø—É–ª—å—Å–∏–≤–Ω–æ—Å—Ç—å"
        },
        "–¢—É–∑ –ö—É–±–∫–æ–≤": {
            "upright": "–ù–æ–≤–∞—è –ª—é–±–æ–≤—å, —ç–º–æ—Ü–∏–∏, –∏–Ω—Ç—É–∏—Ü–∏—è, –¥—É—Ö–æ–≤–Ω–æ—Å—Ç—å",
            "reversed": "–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å–ø–∞–¥, –ø—É—Å—Ç–æ—Ç–∞, –ø–æ—Ç–µ—Ä—è —á—É–≤—Å—Ç–≤"
        },
        "–î–≤–æ–π–∫–∞ –ö—É–±–∫–æ–≤": {
            "upright": "–°–æ—é–∑, –ø—Ä–∏—Ç—è–∂–µ–Ω–∏–µ, –≥–∞—Ä–º–æ–Ω–∏—è, –ø–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ",
            "reversed": "–†–∞–∑—Ä—ã–≤, –¥–∏—Å–±–∞–ª–∞–Ω—Å, –∫–æ–Ω—Ñ–ª–∏–∫—Ç"
        },
        "–¢—Ä–æ–π–∫–∞ –ö—É–±–∫–æ–≤": {
            "upright": "–ü—Ä–∞–∑–¥–Ω–∏–∫, –¥—Ä—É–∂–±–∞, —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ, —Å–æ–æ–±—â–µ—Å—Ç–≤–æ",
            "reversed": "–ß—Ä–µ–∑–º–µ—Ä–Ω–æ–µ –≤–µ—Å–µ–ª—å–µ, –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–æ, –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã"
        },
        "–ß–µ—Ç–≤–µ—Ä–∫–∞ –ö—É–±–∫–æ–≤": {
            "upright": "–ê–ø–∞—Ç–∏—è, —Å–æ–∑–µ—Ä—Ü–∞–Ω–∏–µ, –æ—Ç—Å—Ç—Ä–∞–Ω–µ–Ω–Ω–æ—Å—Ç—å, –Ω–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å",
            "reversed": "–ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏, –ø—Ä–∏–Ω—è—Ç–∏–µ, –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å"
        },
        "–ü—è—Ç–µ—Ä–∫–∞ –ö—É–±–∫–æ–≤": {
            "upright": "–ü–æ—Ç–µ—Ä—è, —Å–æ–∂–∞–ª–µ–Ω–∏–µ, —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω–∏–µ, –ø–µ—á–∞–ª—å",
            "reversed": "–ü—Ä–∏–Ω—è—Ç–∏–µ, –ø—Ä–æ—â–µ–Ω–∏–µ, –¥–≤–∏–∂–µ–Ω–∏–µ –≤–ø–µ—Ä–µ–¥"
        },
        "–®–µ—Å—Ç–µ—Ä–∫–∞ –ö—É–±–∫–æ–≤": {
            "upright": "–ù–æ—Å—Ç–∞–ª—å–≥–∏—è, –¥–µ—Ç—Å—Ç–≤–æ, –Ω–µ–≤–∏–Ω–Ω–æ—Å—Ç—å, —â–µ–¥—Ä–æ—Å—Ç—å",
            "reversed": "–ó–∞—Å—Ç—Ä–µ–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ—à–ª–æ–º, –Ω–∞–∏–≤–Ω–æ—Å—Ç—å"
        },
        "–°–µ–º–µ—Ä–∫–∞ –ö—É–±–∫–æ–≤": {
            "upright": "–í—ã–±–æ—Ä, –∏–ª–ª—é–∑–∏–∏, —Ñ–∞–Ω—Ç–∞–∑–∏–∏, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏",
            "reversed": "–†–µ—à–µ–Ω–∏–µ, —è—Å–Ω–æ—Å—Ç—å, —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –ø–æ–¥—Ö–æ–¥"
        },
        "–í–æ—Å—å–º–µ—Ä–∫–∞ –ö—É–±–∫–æ–≤": {
            "upright": "–û—Ç—Å—Ç—É–ø–ª–µ–Ω–∏–µ, –æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ, –ø–æ–∏—Å–∫ –≥–ª—É–±–∏–Ω—ã",
            "reversed": "–ò–∑–±–µ–≥–∞–Ω–∏–µ, —Å—Ç—Ä–∞—Ö —É—Ö–æ–¥–∞, –∑–∞—Å—Ç—Ä–µ–≤–∞–Ω–∏–µ"
        },
        "–î–µ–≤—è—Ç–∫–∞ –ö—É–±–∫–æ–≤": {
            "upright": "–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–∏–µ, —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ, –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–π –∫–æ–º—Ñ–æ—Ä—Ç",
            "reversed": "–¢—â–µ—Å–ª–∞–≤–∏–µ, –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–º, –Ω–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å"
        },
        "–î–µ—Å—è—Ç–∫–∞ –ö—É–±–∫–æ–≤": {
            "upright": "–°–µ–º–µ–π–Ω–æ–µ —Å—á–∞—Å—Ç—å–µ, –≥–∞—Ä–º–æ–Ω–∏—è, —Ä–∞–¥–æ—Å—Ç—å, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ",
            "reversed": "–°–µ–º–µ–π–Ω—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã, –¥–∏—Å–≥–∞—Ä–º–æ–Ω–∏—è, —Ä–∞–∑–æ–±—â–µ–Ω–Ω–æ—Å—Ç—å"
        },
        "–ü–∞–∂ –ö—É–±–∫–æ–≤": {
            "upright": "–¢–≤–æ—Ä—á–µ—Å–∫–∏–µ –Ω–æ–≤–æ—Å—Ç–∏, –∏–Ω—Ç—É–∏—Ü–∏—è, —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å",
            "reversed": "–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –Ω–µ–∑—Ä–µ–ª–æ—Å—Ç—å, —Å–ø–ª–µ—Ç–Ω–∏, —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω–∏–µ"
        },
        "–†—ã—Ü–∞—Ä—å –ö—É–±–∫–æ–≤": {
            "upright": "–†–æ–º–∞–Ω—Ç–∏–∫–∞, –æ—á–∞—Ä–æ–≤–∞–Ω–∏–µ, –∏–¥–µ–∞–ª–∏–∑–º, –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è",
            "reversed": "–†–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω–∏–µ, –ø–µ—Å—Å–∏–º–∏–∑–º, –Ω–µ—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –æ–∂–∏–¥–∞–Ω–∏—è"
        },
        "–ö–æ—Ä–æ–ª–µ–≤–∞ –ö—É–±–∫–æ–≤": {
            "upright": "–°–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏–µ, –∑–∞–±–æ—Ç–∞, –∏–Ω—Ç—É–∏—Ü–∏—è, —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∑—Ä–µ–ª–æ—Å—Ç—å",
            "reversed": "–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, –ø–æ–¥–∞–≤–ª–µ–Ω–Ω–æ—Å—Ç—å"
        },
        "–ö–æ—Ä–æ–ª—å –ö—É–±–∫–æ–≤": {
            "upright": "–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å, –¥–∏–ø–ª–æ–º–∞—Ç–∏—è, —Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏–µ",
            "reversed": "–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –º–∞–Ω–∏–ø—É–ª—è—Ü–∏—è, –ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ —á—É–≤—Å—Ç–≤"
        },
        "–¢—É–∑ –ú–µ—á–µ–π": {
            "upright": "–ü—Ä–æ—Ä—ã–≤, —è—Å–Ω–æ—Å—Ç—å, –æ—Å—Ç—Ä–æ–µ –º—ã—à–ª–µ–Ω–∏–µ, –∏—Å—Ç–∏–Ω–∞",
            "reversed": "–ü—É—Ç–∞–Ω–∏—Ü–∞, –∂–µ—Å—Ç–æ–∫–æ—Å—Ç—å, —Ö–∞–æ—Å"
        },
        "–î–≤–æ–π–∫–∞ –ú–µ—á–µ–π": {
            "upright": "–¢—É–ø–∏–∫, —Ç—Ä—É–¥–Ω—ã–π –≤—ã–±–æ—Ä, —Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ",
            "reversed": "–†–µ—à–µ–Ω–∏–µ, –¥–≤–∏–∂–µ–Ω–∏–µ –≤–ø–µ—Ä–µ–¥, —Å–Ω—è—Ç–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫"
        },
        "–¢—Ä–æ–π–∫–∞ –ú–µ—á–µ–π": {
            "upright": "–°–µ—Ä–¥–µ—á–Ω–∞—è –±–æ–ª—å, –ø–µ—á–∞–ª—å, –≥–æ—Ä–µ, –ø—Ä–µ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ",
            "reversed": "–ò—Å—Ü–µ–ª–µ–Ω–∏–µ, –ø—Ä–æ—â–µ–Ω–∏–µ, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ"
        },
        "–ß–µ—Ç–≤–µ—Ä–∫–∞ –ú–µ—á–µ–π": {
            "upright": "–û—Ç–¥—ã—Ö, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ, —Å–æ–∑–µ—Ä—Ü–∞–Ω–∏–µ, –º–µ–¥–∏—Ç–∞—Ü–∏—è",
            "reversed": "–ë–µ—Å–ø–æ–∫–æ–π—Å—Ç–≤–æ, –∑–∞—Å—Ç–æ–π, –ø–µ—Ä–µ—É—Ç–æ–º–ª–µ–Ω–∏–µ"
        },
        "–ü—è—Ç–µ—Ä–∫–∞ –ú–µ—á–µ–π": {
            "upright": "–ö–æ–Ω—Ñ–ª–∏–∫—Ç, —É–Ω–∏–∂–µ–Ω–∏–µ, –ø–æ—Ä–∞–∂–µ–Ω–∏–µ, —ç–≥–æ–∏–∑–º",
            "reversed": "–ü—Ä–∏–º–∏—Ä–µ–Ω–∏–µ, –ø—Ä–æ—â–µ–Ω–∏–µ, –¥–≤–∏–∂–µ–Ω–∏–µ –¥–∞–ª—å—à–µ"
        },
        "–®–µ—Å—Ç–µ—Ä–∫–∞ –ú–µ—á–µ–π": {
            "upright": "–ü–µ—Ä–µ—Ö–æ–¥, –¥–≤–∏–∂–µ–Ω–∏–µ –≤–ø–µ—Ä–µ–¥, –æ—Ç–ø—É—Å–∫–∞–Ω–∏–µ, –∏—Å—Ü–µ–ª–µ–Ω–∏–µ",
            "reversed": "–ó–∞—Å—Ç—Ä–µ–≤–∞–Ω–∏–µ, —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –±–∞–≥–∞–∂, –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–≤–∏–≥–∞—Ç—å—Å—è"
        },
        "–°–µ–º–µ—Ä–∫–∞ –ú–µ—á–µ–π": {
            "upright": "–•–∏—Ç—Ä–æ—Å—Ç—å, —Å—Ç—Ä–∞—Ç–µ–≥–∏—è, –∏–∑–±–µ–≥–∞–Ω–∏–µ, —Å–µ–∫—Ä–µ—Ç—ã",
            "reversed": "–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ, —á–µ—Å—Ç–Ω–æ—Å—Ç—å, –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ"
        },
        "–í–æ—Å—å–º–µ—Ä–∫–∞ –ú–µ—á–µ–π": {
            "upright": "–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, —á—É–≤—Å—Ç–≤–æ –ª–æ–≤—É—à–∫–∏, —Å–∞–º–æ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ",
            "reversed": "–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ, –Ω–æ–≤—ã–µ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã, —Å–≤–æ–±–æ–¥–∞"
        },
        "–î–µ–≤—è—Ç–∫–∞ –ú–µ—á–µ–π": {
            "upright": "–¢—Ä–µ–≤–æ–≥–∞, —Å—Ç—Ä–∞—Ö–∏, –∫–æ—à–º–∞—Ä—ã, —á—É–≤—Å—Ç–≤–æ –≤–∏–Ω—ã",
            "reversed": "–ù–∞–¥–µ–∂–¥–∞, –∏—Å—Ü–µ–ª–µ–Ω–∏–µ, –ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ö–æ–≤"
        },
        "–î–µ—Å—è—Ç–∫–∞ –ú–µ—á–µ–π": {
            "upright": "–ö–æ–Ω–µ—Ü, –ø–æ—Ä–∞–∂–µ–Ω–∏–µ, –ø—Ä–µ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ, –ø–æ—Ç–µ—Ä—è",
            "reversed": "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ, –≤–æ–∑—Ä–æ–∂–¥–µ–Ω–∏–µ, –Ω–æ–≤–∞—è –Ω–∞–¥–µ–∂–¥–∞"
        },
        "–ü–∞–∂ –ú–µ—á–µ–π": {
            "upright": "–õ—é–±–æ–ø—ã—Ç—Å—Ç–≤–æ, –Ω–æ–≤—ã–µ –∏–¥–µ–∏, –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è, –±–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å",
            "reversed": "–°–ø–ª–µ—Ç–Ω–∏, –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏, –Ω–µ—á–µ—Å—Ç–Ω–æ—Å—Ç—å"
        },
        "–†—ã—Ü–∞—Ä—å –ú–µ—á–µ–π": {
            "upright": "–ê–º–±–∏—Ü–∏–∏, —Å–∫–æ—Ä–æ—Å—Ç—å, –∞–≥—Ä–µ—Å—Å–∏—è, –Ω–µ—Ç–µ—Ä–ø–µ–Ω–∏–µ",
            "reversed": "–ò–º–ø—É–ª—å—Å–∏–≤–Ω–æ—Å—Ç—å, –±–µ–∑—Ä–∞—Å—Å—É–¥—Å—Ç–≤–æ, –∑–∞–¥–µ—Ä–∂–∫–∏"
        },
        "–ö–æ—Ä–æ–ª–µ–≤–∞ –ú–µ—á–µ–π": {
            "upright": "–Ø—Å–Ω–æ—Å—Ç—å —É–º–∞, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, –ø—Ä–∏–Ω—Ü–∏–ø–∏–∞–ª—å–Ω–æ—Å—Ç—å",
            "reversed": "–•–æ–ª–æ–¥–Ω–æ—Å—Ç—å, –∂–µ—Å—Ç–æ–∫–æ—Å—Ç—å, –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏"
        },
        "–ö–æ—Ä–æ–ª—å –ú–µ—á–µ–π": {
            "upright": "–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç, –ø—Ä–∞–≤–¥–∞, –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç, —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å",
            "reversed": "–ú–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏, –∂–µ—Å—Ç–æ–∫–æ—Å—Ç—å, —Ç–∏—Ä–∞–Ω–∏—è"
        },
        "–¢—É–∑ –ü–µ–Ω—Ç–∞–∫–ª–µ–π": {
            "upright": "–ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏, –±–æ–≥–∞—Ç—Å—Ç–≤–æ, –ø—Ä–æ—Ü–≤–µ—Ç–∞–Ω–∏–µ, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å",
            "reversed": "–ü–æ—Ç–µ—Ä—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π, –∂–∞–¥–Ω–æ—Å—Ç—å, –ø–ª–æ—Ö–∏–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏"
        },
        "–î–≤–æ–π–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π": {
            "upright": "–ë–∞–ª–∞–Ω—Å, –∞–¥–∞–ø—Ç–∞—Ü–∏—è, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã, –≥–∏–±–∫–æ—Å—Ç—å",
            "reversed": "–î–∏—Å–±–∞–ª–∞–Ω—Å, –Ω–µ–æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–æ—Å—Ç—å, –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞"
        },
        "–¢—Ä–æ–π–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π": {
            "upright": "–°–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ, –æ–±—É—á–µ–Ω–∏–µ, —Ä–æ—Å—Ç, –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ",
            "reversed": "–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞, –Ω–µ–¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å"
        },
        "–ß–µ—Ç–≤–µ—Ä–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π": {
            "upright": "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –∫–æ–Ω—Ç—Ä–æ–ª—å, —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å",
            "reversed": "–ñ–∞–¥–Ω–æ—Å—Ç—å, —Ä–∞—Å—Ç–æ—á–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —Ü–µ–ø–ª—è–Ω–∏–µ"
        },
        "–ü—è—Ç–µ—Ä–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π": {
            "upright": "–ù—É–∂–¥–∞, –±–µ–¥–Ω–æ—Å—Ç—å, –∏–∑–æ–ª—è—Ü–∏—è, —Ç—Ä–µ–≤–æ–≥–∞",
            "reversed": "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ, —â–µ–¥—Ä–æ—Å—Ç—å, –¥—É—Ö–æ–≤–Ω–æ–µ –±–æ–≥–∞—Ç—Å—Ç–≤–æ"
        },
        "–®–µ—Å—Ç–µ—Ä–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π": {
            "upright": "–©–µ–¥—Ä–æ—Å—Ç—å, –±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –ø–æ–º–æ—â—å, –æ–±–º–µ–Ω",
            "reversed": "–î–æ–ª–≥–∏, —ç–≥–æ–∏–∑–º, –Ω–µ—Ä–∞–≤–µ–Ω—Å—Ç–≤–æ"
        },
        "–°–µ–º–µ—Ä–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π": {
            "upright": "–¢–µ—Ä–ø–µ–Ω–∏–µ, –Ω–∞–≥—Ä–∞–¥–∞, –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏, —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è",
            "reversed": "–ù–µ—Ç–µ—Ä–ø–µ–Ω–∏–µ, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –Ω–∞–≥—Ä–∞–¥, –Ω–µ—É–¥–∞—á–Ω—ã–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏"
        },
        "–í–æ—Å—å–º–µ—Ä–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π": {
            "upright": "–ú–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ, –∫–∞—á–µ—Å—Ç–≤–æ, —Ä–µ–º–µ—Å–ª–æ, –ø—Ä–µ–¥–∞–Ω–Ω–æ—Å—Ç—å –¥–µ–ª—É",
            "reversed": "–ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ, –ª–µ–Ω—å, –ø–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏–∑–º"
        },
        "–î–µ–≤—è—Ç–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π": {
            "upright": "–ò–∑–æ–±–∏–ª–∏–µ, —Ä–æ—Å–∫–æ—à—å, —Å–∞–º–æ–æ–±–µ—Å–ø–µ—á–µ–Ω–Ω–æ—Å—Ç—å, –Ω–∞–≥—Ä–∞–¥–∞",
            "reversed": "–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω–æ—Å—Ç—å, –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–º"
        },
        "–î–µ—Å—è—Ç–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π": {
            "upright": "–ë–æ–≥–∞—Ç—Å—Ç–≤–æ, –Ω–∞—Å–ª–µ–¥–∏–µ, —Å–µ–º—å—è, —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å",
            "reversed": "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ—Ç–µ—Ä–∏, —Å–µ–º–µ–π–Ω—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã, –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å"
        },
        "–ü–∞–∂ –ü–µ–Ω—Ç–∞–∫–ª–µ–π": {
            "upright": "–û–±—É—á–µ–Ω–∏–µ, –∏–∑—É—á–µ–Ω–∏–µ, –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏, –∞–º–±–∏—Ü–∏–∏",
            "reversed": "–õ–µ–Ω—å, —Ä–∞—Å—Ç–æ—á–∏—Ç–µ–ª—å—Å—Ç–≤–æ, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–º–±–∏—Ü–∏–π"
        },
        "–†—ã—Ü–∞—Ä—å –ü–µ–Ω—Ç–∞–∫–ª–µ–π": {
            "upright": "–¢—Ä—É–¥–æ–ª—é–±–∏–µ, –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å, –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å, –ø—Ä–æ–≥—Ä–µ—Å—Å",
            "reversed": "–õ–µ–Ω—å, –±–µ–∑–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å, –∑–∞—Å—Ç–æ–π"
        },
        "–ö–æ—Ä–æ–ª–µ–≤–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π": {
            "upright": "–ò–∑–æ–±–∏–ª–∏–µ, –∑–∞–±–æ—Ç–∞, –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å, –∫–æ–º—Ñ–æ—Ä—Ç",
            "reversed": "–ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–º, —Ä–µ–≤–Ω–æ—Å—Ç—å, –Ω–µ–Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å"
        },
        "–ö–æ—Ä–æ–ª—å –ü–µ–Ω—Ç–∞–∫–ª–µ–π": {
            "upright": "–ë–æ–≥–∞—Ç—Å—Ç–≤–æ, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –ª–∏–¥–µ—Ä—Å—Ç–≤–æ, —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å",
            "reversed": "–ñ–∞–¥–Ω–æ—Å—Ç—å, –∂–µ—Å—Ç–∫–æ—Å—Ç—å, –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–º"
        }
    }
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∫–∞—Ä—Ç–∞ –≤ —Å–ª–æ–≤–∞—Ä–µ
    if card_name in TAROT_MEANINGS:
        return TAROT_MEANINGS[card_name][orientation]
    
    # Fallback –¥–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫–∞—Ä—Ç
    print(f"‚ö†Ô∏è –ö–∞—Ä—Ç–∞ '{card_name}' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Å–ª–æ–≤–∞—Ä–µ –∑–Ω–∞—á–µ–Ω–∏–π")
    return f"{'–ü—Ä—è–º–æ–µ' if orientation == 'upright' else '–ü–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–æ–µ'} –∑–Ω–∞—á–µ–Ω–∏–µ {card_name}"
# –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ä—Ç—ã –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
TAROT_CARDS = load_tarot_cards()
print(f"üÉè –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞: {len(TAROT_CARDS)} –∫–∞—Ä—Ç –¢–∞—Ä–æ")

# ========== TELEGRAM FILE_ID API ==========
@app.get("/api/get-photo")
async def get_photo(file_id: str):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ä—Ç—ã –∏–∑ Telegram"""
    try:
        # –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
        BOT_TOKEN = os.environ.get("BOT_TOKEN", "")
        
        if not BOT_TOKEN:
            print("‚ö†Ô∏è BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
            return {
                "success": False,
                "url": "",
                "error": "Bot token not configured"
            }
        
        # –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ –æ—Ç Telegram
        file_info_url = f"https://api.telegram.org/bot{BOT_TOKEN}/getFile?file_id={file_id}"
        
        print(f"üîó –ó–∞–ø—Ä–æ—Å –∫ Telegram API: {file_info_url[:50]}...")
        
        response = requests.get(file_info_url, timeout=10)
        
        if response.status_code != 200:
            print(f"‚ùå Telegram API –≤–µ—Ä–Ω—É–ª —Å—Ç–∞—Ç—É—Å: {response.status_code}")
            return {
                "success": False,
                "url": "",
                "error": f"Telegram API error: {response.status_code}"
            }
        
        file_data = response.json()
        
        if not file_data.get("ok"):
            print(f"‚ùå Telegram API –æ—à–∏–±–∫–∞: {file_data}")
            return {
                "success": False,
                "url": "",
                "error": f"Telegram error: {file_data.get('description', 'Unknown')}"
            }
        
        file_path = file_data["result"]["file_path"]
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º –ø—É–±–ª–∏—á–Ω—ã–π URL –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
        photo_url = f"https://api.telegram.org/file/bot{BOT_TOKEN}/{file_path}"
        
        print(f"‚úÖ –ü–æ–ª—É—á–µ–Ω URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: {photo_url[:80]}...")
        
        return {
            "success": True,
            "url": photo_url,
            "file_path": file_path,
            "telegram_url": photo_url
        }
        
    except requests.exceptions.Timeout:
        print("‚ùå –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞ –∫ Telegram API")
        return {
            "success": False,
            "url": "",
            "error": "Telegram API timeout"
        }
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –≤ get_photo: {str(e)}")
        return {
            "success": False,
            "url": "",
            "error": str(e)
        }

# ========== –û–°–ù–û–í–ù–´–ï API ENDPOINTS ==========
@app.get("/")
async def root():
    return {
        "status": "Tarot Web App API is running",
        "cards_count": len(TAROT_CARDS),
        "endpoints": ["/api/health", "/api/draw-cards", "/api/get-photo"]
    }

@app.get("/api/health")
async def health_check():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è API"""
    return {
        "status": "healthy",
        "service": "tarot-web-app",
        "cards_available": len(TAROT_CARDS),
        "timestamp": datetime.now().isoformat(),
        "environment": "production" if os.environ.get("VERCEL") else "development"
    }

@app.post("/api/draw-cards")
async def draw_cards(request: DrawRequest):
    """–í—ã–±–æ—Ä —Å–ª—É—á–∞–π–Ω—ã—Ö –∫–∞—Ä—Ç –¥–ª—è –≥–∞–¥–∞–Ω–∏—è —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏"""
    try:
        # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–æ–ø—Ä–æ—Å–∞
        if not request.question or len(request.question.strip()) < 3:
            raise HTTPException(
                status_code=400,
                detail="–í–æ–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞"
            )
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ä—Ç
        count = min(request.count, 10)
        if count > len(TAROT_CARDS):
            count = len(TAROT_CARDS)
        
        if count < 1:
            raise HTTPException(
                status_code=400,
                detail="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ä—Ç –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 1 –¥–æ 10"
            )
        
        # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –∫–∞—Ä—Ç—ã
        selected_cards = random.sample(TAROT_CARDS, count)
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç —Å –∫–∞—Ä—Ç–∞–º–∏
        result_cards = []
        for card in selected_cards:
            orientation = random.choice(["upright", "reversed"])
            
            # –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã
            meaning = card["meaning_upright"] if orientation == "upright" else card["meaning_reversed"]
            
            # –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            image_url = ""
            try:
                photo_response = await get_photo(card["file_id"])
                if photo_response["success"]:
                    image_url = photo_response["url"]
                    print(f"‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è {card['name']}: {image_url[:50]}...")
                else:
                    print(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è {card['name']}")
            except Exception as e:
                print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: {e}")
            
            result_cards.append({
                "id": card["id"],
                "name": card["name"],
                "file_id": card["file_id"],
                "orientation": orientation,
                "meaning": meaning,
                "image_url": image_url,  # URL –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
                "has_image": bool(image_url)
            })
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º ID —Ä–∞—Å–∫–ª–∞–¥–∞
        reading_id = f"reading_{datetime.now().strftime('%Y%m%d%H%M%S')}_{random.randint(1000, 9999)}"
        
        return {
            "success": True,
            "reading_id": reading_id,
            "cards": result_cards,
            "question": request.question,
            "cards_count": len(result_cards),
            "cards_with_images": sum(1 for card in result_cards if card["has_image"]),
            "timestamp": datetime.now().isoformat()
        }
        
    except HTTPException:
        raise
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –≤ draw_cards: {str(e)}")
        raise HTTPException(
            status_code=500,
            detail=f"–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: {str(e)}"
        )

@app.post("/api/save-reading")
async def save_reading(request: SaveRequest):
    """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞—Å–∫–ª–∞–¥–∞ –≤ –∏—Å—Ç–æ—Ä–∏—é"""
    try:
        conn = sqlite3.connect(DB_PATH)
        cursor = conn.cursor()
        
        cursor.execute('''
            INSERT INTO readings (user_id, question, cards, interpretation)
            VALUES (?, ?, ?, ?)
        ''', (
            request.user_id,
            request.question,
            json.dumps(request.cards, ensure_ascii=False),
            request.interpretation
        ))
        
        conn.commit()
        reading_id = cursor.lastrowid
        conn.close()
        
        return {
            "success": True, 
            "message": "–†–∞—Å–∫–ª–∞–¥ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω",
            "reading_id": reading_id,
            "saved_at": datetime.now().isoformat()
        }
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: {str(e)}")
        raise HTTPException(
            status_code=500,
            detail=f"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: {str(e)}"
        )

@app.get("/api/history")
async def get_history(user_id: int):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –≥–∞–¥–∞–Ω–∏–π"""
    try:
        conn = sqlite3.connect(DB_PATH)
        conn.row_factory = sqlite3.Row
        cursor = conn.cursor()
        
        cursor.execute('''
            SELECT id, question, cards, interpretation, created_at
            FROM readings 
            WHERE user_id = ? 
            ORDER BY created_at DESC 
            LIMIT 20
        ''', (user_id,))
        
        rows = cursor.fetchall()
        conn.close()
        
        history = []
        for row in rows:
            try:
                cards_data = json.loads(row["cards"])
            except:
                cards_data = []
            
            history.append({
                "id": row["id"],
                "question": row["question"],
                "cards": cards_data,
                "interpretation": row["interpretation"],
                "date": row["created_at"]
            })
        
        return {
            "success": True, 
            "history": history,
            "count": len(history)
        }
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏: {str(e)}")
        raise HTTPException(
            status_code=500,
            detail=f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏: {str(e)}"
        )


# –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
def generate_interpretation(cards, question):
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏"""
    
    # –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    upright_count = sum(1 for card in cards if card.get("orientation") == "upright")
    total_cards = len(cards)
    
    # –ê–Ω–∞–ª–∏–∑ –ø–æ –ø–æ–∑–∏—Ü–∏—è–º
    position_meanings = [
        "–°–æ–±—ã—Ç–∏—è –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–∏–∑–æ–π–¥—É—Ç",
        "–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–µ–≥—Ä–∞–¥—ã", 
        "–ò—Å—Ç–æ—á–Ω–∏–∫ –Ω–µ–ø—Ä–∏—è—Ç–Ω–æ—Å—Ç–µ–π",
        "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∫ –¥–µ–π—Å—Ç–≤–∏—é",
        "–ö–∞–∫ –±—É–¥—É—Ç —Ä–∞–∑–≤–∏–≤–∞—Ç—å—Å—è —Å–æ–±—ã—Ç–∏—è"
    ]
    
    interpretation = f"üîÆ *–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–∞—Å–∫–ª–∞–¥–∞:*\n\n"
    interpretation += f"üìù *–í–∞—à –≤–æ–ø—Ä–æ—Å:* {question}\n\n"
    
    # –ê–Ω–∞–ª–∏–∑ –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç—ã
    for i, card in enumerate(cards):
        position = position_meanings[i] if i < len(position_meanings) else f"–ü–æ–∑–∏—Ü–∏—è {i+1}"
        orientation_icon = "üîº" if card.get("orientation") == "upright" else "üîΩ"
        
        interpretation += f"**{position}:**\n"
        interpretation += f"‚Ä¢ *–ö–∞—Ä—Ç–∞:* {card['name']} {orientation_icon}\n"
        interpretation += f"‚Ä¢ *–ó–Ω–∞—á–µ–Ω–∏–µ:* {card.get('meaning', '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è')}\n\n"
    
    # –û–±—â–∏–π –∞–Ω–∞–ª–∏–∑
    interpretation += "üìä *–û–±—â–∏–π –∞–Ω–∞–ª–∏–∑ —Ä–∞—Å–∫–ª–∞–¥–∞:*\n"
    
    if upright_count == total_cards:
        interpretation += "‚Ä¢ –í—Å–µ –∫–∞—Ä—Ç—ã –ø—Ä—è–º—ã–µ - –æ—á–µ–Ω—å –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω—ã–π –∑–Ω–∞–∫!\n"
        interpretation += "‚Ä¢ –°–∏—Ç—É–∞—Ü–∏—è —Ä–∞–∑–≤–∏–≤–∞–µ—Ç—Å—è –≥–∞—Ä–º–æ–Ω–∏—á–Ω–æ\n"
        interpretation += "‚Ä¢ –°–º–µ–ª–æ –¥–µ–π—Å—Ç–≤—É–π—Ç–µ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏\n"
    elif upright_count >= total_cards / 2:
        interpretation += "‚Ä¢ –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∫–∞—Ä—Ç –ø—Ä—è–º—ã–µ - –ø–æ–∑–∏—Ç–∏–≤–Ω–∞—è –¥–∏–Ω–∞–º–∏–∫–∞\n"
        interpretation += "‚Ä¢ –ï—Å—Ç—å –Ω–µ–±–æ–ª—å—à–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è, –Ω–æ –æ–Ω–∏ –ø—Ä–µ–æ–¥–æ–ª–∏–º—ã\n"
        interpretation += "‚Ä¢ –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –¥–≤–∏–∂–µ–Ω–∏–µ –≤–ø–µ—Ä–µ–¥\n"
    else:
        interpretation += "‚Ä¢ –ú–Ω–æ–≥–æ –ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç—ã—Ö –∫–∞—Ä—Ç - –≤—Ä–µ–º—è –¥–ª—è —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–π\n"
        interpretation += "‚Ä¢ –í–æ–∑–º–æ–∂–Ω—ã –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏\n"
        interpretation += "‚Ä¢ –ü–µ—Ä–µ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–≤–æ–π –ø–æ–¥—Ö–æ–¥ –∫ —Å–∏—Ç—É–∞—Ü–∏–∏\n"
    
    # –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Å–æ–≤–µ—Ç
    interpretation += f"\nüí´ *–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Å–æ–≤–µ—Ç:*\n"
    
    advice_options = [
        "–î–æ–≤–µ—Ä—å—Ç–µ—Å—å —Å–≤–æ–µ–π –∏–Ω—Ç—É–∏—Ü–∏–∏ –≤ –ø—Ä–∏–Ω—è—Ç–∏–∏ —Ä–µ—à–µ–Ω–∏–π",
        "–ü—Ä–æ—è–≤–∏—Ç–µ —Ç–µ—Ä–ø–µ–Ω–∏–µ, –≤–∞–∂–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–∏—Ö–æ–¥—è—Ç —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º",
        "–ë—É–¥—å—Ç–µ –æ—Ç–∫—Ä—ã—Ç—ã –∫ –Ω–æ–≤—ã–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º",
        "–°—Ñ–æ–∫—É—Å–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ –≥–ª–∞–≤–Ω–æ–º, –æ—Å—Ç–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–∏—Ç—Å—è",
        "–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è –ø–æ–º–æ–∂–µ—Ç —Ä–µ—à–∏—Ç—å –º–Ω–æ–≥–∏–µ –≤–æ–ø—Ä–æ—Å—ã",
        "–ù–µ –±–æ–π—Ç–µ—Å—å –ø—Ä–æ—Å–∏—Ç—å –ø–æ–º–æ—â–∏ —É –±–ª–∏–∑–∫–∏—Ö"
    ]
    
    interpretation += f"{random.choice(advice_options)}\n\n"
    interpretation += f"‚ú® *–ü—É—Å—Ç—å –∑–≤—ë–∑–¥—ã –±–ª–∞–≥–æ–≤–æ–ª—è—Ç –≤–∞–º!* ‚ú®"
    
    return interpretation
@app.get("/api/debug")
async def debug():
    """Endpoint –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏"""
    import os
    
    info = {
        "current_directory": os.getcwd(),
        "files_in_root": [],
        "files_in_api": [],
        "file_exists": {
            "file_ids.json": os.path.exists("file_ids.json"),
            "/tmp/file_ids.json": os.path.exists("/tmp/file_ids.json"),
            "api/file_ids.json": os.path.exists("api/file_ids.json")
        }
    }
    
    try:
        info["files_in_root"] = os.listdir('.')
    except:
        pass
    
    try:
        info["files_in_api"] = os.listdir('api')
    except:
        pass
    
    return info
# –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
if __name__ == "__main__":
    import uvicorn
    print("üöÄ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ Tarot Web App...")
    print(f"üÉè –î–æ—Å—Ç—É–ø–Ω–æ –∫–∞—Ä—Ç: {len(TAROT_CARDS)}")
    print("üì° –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω: http://localhost:8000")
    print("üîÆ API –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ: http://localhost:8000/api/draw-cards")
    uvicorn.run(app, host="0.0.0.0", port=8000)
